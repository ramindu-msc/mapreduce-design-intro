version: '2'
services:
  namenode:
    image: ramilu90/hadoop-namenode
    container_name: namenode
    platform: linux/amd64
    volumes:
      - /Users/ramindu/iit/lecture4/mapreduce-design-intro/hadoop-pig-dockercompose/friends-mapreduce.txt:/opt/friends-mapreduce.txt
      - /Users/ramindu/iit/lecture4/mapreduce-design-intro/resources:/opt/hadoop/resources
      # - ./Makefile:/opt/hadoop/Makefile
    environment:
      - CLUSTER_NAME=test
      # - HDFS_SITE_XML_dfs.webhdfs.enabled=true
      # - ENSURE_NAMENODE_DIR=/tmp/hadoop-root/dfs/name
    env_file:
      - ./hadoop-hive.env
    ports:
      - 50070:50070
      # - 9870:9870
    # command: ["hdfs", "namenode"]

  datanode:
    image: ramilu90/hadoop-datanode
    platform: linux/amd64
    container_name: datanode
    depends_on: 
      - namenode
    env_file:
      - ./hadoop-hive.env
    ports:
      - 50075:50075

  resourcemanager:
    image: ramilu90/hadoop-datanode
    platform: linux/amd64
    hostname: resourcemanager
    container_name: resourcemanager
    command: [ "yarn", "resourcemanager" ]
    depends_on:
      - namenode
      - datanode
    ports:
      - 8088:8088
    env_file:
      - ./hadoop-hive.env
    volumes:
      - ./test.sh:/opt/test.sh
  nodemanager:
    image: ramilu90/hadoop-datanode
    container_name: nodemanager
    platform: linux/amd64
    command: [ "yarn", "nodemanager" ]
    env_file:
      - ./hadoop-hive.env
  pig:
    image: ramilu90/pig
    container_name: pig
    platform: linux/amd64
    depends_on:
      - namenode
      - datanode
      - resourcemanager
    environment:
      - PIG_CONF_DIR=/opt/pig/conf
      - HADOOP_CONF_DIR=/etc/hadoop/conf
    volumes:
      - /Users/ramindu/iit/lecture4/mapreduce-design-intro/hadoop-hive-dockercompose/recharge.input:/opt/recharge.input
      - /Users/ramindu/iit/lecture4/mapreduce-design-intro/hadoop-pig-dockercompose/l_get_friends.pig:/opt/l_get_friends.pig
      - /Users/ramindu/iit/lecture4/mapreduce-design-intro/hadoop-pig-dockercompose/friends.txt:/opt/friends.txt
      - /Users/ramindu/iit/lecture4/mapreduce-design-intro/hadoop-pig-dockercompose/l_get_friends_mapreduce.pig:/opt/l_get_friends_mapreduce.pig
      - /Users/ramindu/iit/lecture4/mapreduce-design-intro/hadoop-pig-dockercompose/pig_conf:/opt/pig/conf/
      - /Users/ramindu/iit/lecture4/mapreduce-design-intro/hadoop-pig-dockercompose/hadoop_conf:/etc/hadoop/conf 
    command: tail -f /dev/null

  spark-master:
    image: ramilu90/spark-master
    container_name: spark-master
    platform: linux/amd64
    ports:
      - 8080:8080
      - 7077:7077
    env_file:
      - ./hadoop-hive.env

  spark-worker:
    image: ramilu90/spark-worker
    container_name: spark-worker
    platform: linux/amd64
    depends_on:
      - spark-master
    environment:
      - SPARK_MASTER=spark://spark-master:7077
    ports:
      - "8081:8081"
    env_file:
      - ./hadoop-hive.env

  spark-notebook:
    image: ramilu90/spark-notebook
    platform: linux/amd64
    container_name: spark-notebook
    env_file:
      - ./hadoop-hive.env
    ports:
      - 9001:9001

  hue:
    image: ramilu90/hdfs-filebrowser
    container_name: hue
    platform: linux/amd64
    ports:
      - 8089:8088
    environment:
      - NAMENODE_HOST=namenode

  hive-server:
    image: ramilu90/hive
    platform: linux/amd64
    volumes:
      - /Users/ramindu/iit/lecture4/mapreduce-design-intro/hadoop-hive-dockercompose/recharge.input:/opt/recharge.input
    container_name: hive-server
    env_file:
      - ./hadoop-hive.env
    environment:
      - "HIVE_CORE_CONF_javax_jdo_option_ConnectionURL=jdbc:postgresql://hive-metastore/metastore"
    ports:
      - "10000:10000"
  hive-metastore:
    image: ramilu90/hive
    platform: linux/amd64
    container_name: hive-metastore
    env_file:
      - ./hadoop-hive.env
    command: /opt/hive/bin/hive --service metastore
  hive-metastore-postgresql:
    image: ramilu90/hive-metastore-postgresql
    container_name: hive-metastore-postgresql
    platform: linux/amd64